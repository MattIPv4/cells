<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>Document</title><style>body,canvas,html{padding:0;margin:0;height:100vh;box-sizing:border-box;display:block;width:100%;border:0}</style></head><body> <script>!function(){class t{constructor(t=0,e=0){this.x=t,this.y=e,this.color="rgb(150, 150, 170)"}duplicate(){return new this.constructor(this.x,this.y)}render(t,e){t.ctx.beginPath(),t.ctx.roundRect(this.x*e,this.y*e,e,e,e*t.BORDER_RADIUS),t.ctx.fillStyle=this.color,t.ctx.fill()}update(t){}incrementedX(t){return this.x>=t.width-1?0:this.x+1}incrementX(t,e,...s){const i=this.incrementedX(t);if(i===e.x)return!1;const r=t.cellAt(i,this.y);return!(r&&!r.incrementX(t,e,...s))&&(this.x=i,!0)}decrementedX(t){return this.x<=0?t.width-1:this.x-1}decrementX(t,e,...s){const i=this.decrementedX(t);if(i===e.x)return!1;const r=t.cellAt(i,this.y);return!(r&&!r.decrementX(t,e,...s))&&(this.x=i,!0)}incrementedY(t){return this.y>=t.height-1?0:this.y+1}incrementY(t,e,...s){const i=this.incrementedY(t);if(i===e.y)return!1;const r=t.cellAt(this.x,i);return!(r&&!r.incrementY(t,e,...s))&&(this.y=i,!0)}decrementedY(t){return this.y<=0?t.height-1:this.y-1}decrementY(t,e,...s){const i=this.decrementedY(t);if(i===e.y)return!1;const r=t.cellAt(this.x,i);return!(r&&!r.decrementY(t,e,...s))&&(this.y=i,!0)}}class e extends t{constructor(t=0,e=0,s=0){super(t,e),this.dir=s}duplicate(){return new this.constructor(this.x,this.y,this.dir)}render(t,e){super.render(t,e),t.ctx.translate(this.x*e+.5*e,this.y*e+.5*e),t.ctx.rotate(.5*this.dir*Math.PI),t.ctx.translate(-1*(this.x*e+.5*e),-1*(this.y*e+.5*e)),t.ctx.beginPath(),t.ctx.moveTo(this.x*e+.1*e,this.y*e+.7*e),t.ctx.lineTo(this.x*e+.9*e,this.y*e+.7*e),t.ctx.lineTo(this.x*e+.5*e,this.y*e+.3*e),t.ctx.fillStyle="rgb(255, 255, 255)",t.ctx.fill(),t.ctx.setTransform(1,0,0,1,0,0)}rotatedClockwise(){return this.dir>=3?0:this.dir+1}rotateClockwise(){return this.dir=this.rotatedClockwise(),!0}rotatedAntiClockwise(){return this.dir<0?3:this.dir-1}rotateAntiClockwise(){return this.dir=this.rotatedAntiClockwise(),!0}}class s extends e{constructor(t=0,e=0,s=0){super(t,e,s),this.color="rgb(200, 20, 20)"}update(t){switch(this.dir){case 0:this.destroyNegativeY(t);break;case 1:this.destroyPositiveX(t);break;case 2:this.destroyPositiveY(t);break;case 3:this.destroyNegativeX(t)}}destroyCell(t,e,s){const i=t.cellAt(e,s);return!!i&&(t.cells.delete(i),!0)}destroyPositiveX(t){return this.destroyCell(t,this.incrementedX(t),this.y)}destroyNegativeX(t){return this.destroyCell(t,this.decrementedX(t),this.y)}destroyPositiveY(t){return this.destroyCell(t,this.x,this.incrementedY(t))}destroyNegativeY(t){return this.destroyCell(t,this.x,this.decrementedY(t))}}const i=t.prototype.incrementX;t.prototype.incrementX=function(t,e,s,...r){const c=this.incrementedX(t);return c===e.x&&s?s[e.dir]>s[(e.dir+2)%4]&&(this.x=c,!0):i.call(this,t,e,s,...r)};const r=t.prototype.incrementY;t.prototype.incrementY=function(t,e,s,...i){const c=this.incrementedY(t);return c===e.y&&s?s[e.dir]>s[(e.dir+2)%4]&&(this.y=c,!0):r.call(this,t,e,s,...i)};const c=t.prototype.decrementX;t.prototype.decrementX=function(t,e,s,...i){const r=this.decrementedX(t);return r===e.x&&s?s[e.dir]>s[(e.dir+2)%4]&&(this.x=r,!0):c.call(this,t,e,s,...i)};const h=t.prototype.decrementY;t.prototype.decrementY=function(t,e,s,...i){const r=this.decrementedY(t);return r===e.y&&s?s[e.dir]>s[(e.dir+2)%4]&&(this.y=r,!0):h.call(this,t,e,s,...i)};class n extends e{constructor(t=0,e=0,s=0){super(t,e,s),this.color="rgb(20, 100, 200)"}opposingForceCheck(t,e,s){s[this.dir]++;const i=(this.dir+2)%4;return e.dir!==i||s[e.dir]>s[this.dir]}incrementX(t,e,s=null){return s=s||this.pushEmptyForce(),!!this.opposingForceCheck(t,e,s)&&super.incrementX(t,e,s)}decrementX(t,e,s=null){return s=s||this.pushEmptyForce(),!!this.opposingForceCheck(t,e,s)&&super.decrementX(t,e,s)}incrementY(t,e,s=null){return s=s||this.pushEmptyForce(),!!this.opposingForceCheck(t,e,s)&&super.incrementY(t,e,s)}decrementY(t,e,s=null){return s=s||this.pushEmptyForce(),!!this.opposingForceCheck(t,e,s)&&super.decrementY(t,e,s)}update(t){switch(this.dir){case 0:this.pushNegativeY(t);break;case 1:this.pushPositiveX(t);break;case 2:this.pushPositiveY(t);break;case 3:this.pushNegativeX(t)}}pushEmptyForce(){return{0:0,1:0,2:0,3:0}}pushInitialForce(){return Object.assign(this.pushEmptyForce(),{[this.dir]:1})}pushPositiveX(t){const e=t.cellAt(this.incrementedX(t),this.y);return!e||e.incrementX(t,this,this.pushInitialForce())}pushNegativeX(t){const e=t.cellAt(this.decrementedX(t),this.y);return!e||e.decrementX(t,this,this.pushInitialForce())}pushPositiveY(t){const e=t.cellAt(this.x,this.incrementedY(t));return!e||e.incrementY(t,this,this.pushInitialForce())}pushNegativeY(t){const e=t.cellAt(this.x,this.decrementedY(t));return!e||e.decrementY(t,this,this.pushInitialForce())}}class o extends n{constructor(t=0,e=0,s=0){super(t,e,s),this.color="rgb(200, 150, 20)"}update(t){switch(this.dir){case 0:this.duplicateToNegativeY(t);break;case 1:this.duplicateToPositiveX(t);break;case 2:this.duplicateToPositiveY(t);break;case 3:this.duplicateToNegativeX(t)}}opposingForceCheck(t,e,s){return!0}duplicateCell(t,e){const s=e.duplicate();return t.cells.add(s),s}cellToDuplicate(t){switch(this.dir){case 0:return t.cellAt(this.x,this.incrementedY(t));case 1:return t.cellAt(this.decrementedX(t),this.y);case 2:return t.cellAt(this.x,this.decrementedY(t));case 3:return t.cellAt(this.incrementedX(t),this.y)}}duplicateToPositiveX(t){const e=this.cellToDuplicate(t);return!!e&&(!!this.pushPositiveX(t)&&(this.duplicateCell(t,e).x=this.incrementedX(t),!0))}duplicateToNegativeX(t){const e=this.cellToDuplicate(t);return!!e&&(!!this.pushNegativeX(t)&&(this.duplicateCell(t,e).x=this.decrementedX(t),!0))}duplicateToPositiveY(t){const e=this.cellToDuplicate(t);return!!e&&(!!this.pushPositiveY(t)&&(this.duplicateCell(t,e).y=this.incrementedY(t),!0))}duplicateToNegativeY(t){const e=this.cellToDuplicate(t);return!!e&&(!!this.pushNegativeY(t)&&(this.duplicateCell(t,e).y=this.decrementedY(t),!0))}}class l extends t{constructor(t=0,e=0,s=0){super(t,e,s),this.color="rgb(50, 50, 50)"}render(t,e){super.render(t,e),t.ctx.beginPath(),t.ctx.moveTo(this.x*e+.2*e,this.y*e+.2*e),t.ctx.lineTo(this.x*e+.8*e,this.y*e+.8*e),t.ctx.lineWidth=.1*e,t.ctx.strokeStyle="rgb(30, 30, 30)",t.ctx.stroke(),t.ctx.beginPath(),t.ctx.moveTo(this.x*e+.8*e,this.y*e+.2*e),t.ctx.lineTo(this.x*e+.2*e,this.y*e+.8*e),t.ctx.lineWidth=.1*e,t.ctx.strokeStyle="rgb(30, 30, 30)",t.ctx.stroke()}incrementX(t,e){return!1}decrementX(t,e){return!1}incrementY(t,e){return!1}decrementY(t,e){return!1}}class a extends n{constructor(t=0,e=0,s=0){super(t,e,s),this.color="rgb(20, 150, 250)"}update(t){switch(super.update(t),this.dir){case 0:this.decrementY(t,this);break;case 1:this.incrementX(t,this);break;case 2:this.incrementY(t,this);break;case 3:this.decrementX(t,this)}}}class d extends t{constructor(t=0,e=0,s=!1){super(t,e),this.antiClockwise=s,this.color="rgb(20, 200, 100)"}duplicate(){return new this.constructor(this.x,this.y,this.antiClockwise)}render(t,e){super.render(t,e),t.ctx.beginPath(),t.ctx.arc(this.x*e+.5*e,this.y*e+.5*e,.3*e,this.antiClockwise?1.5*Math.PI:0,this.antiClockwise?Math.PI:1.5*Math.PI),t.ctx.lineWidth=.1*e,t.ctx.strokeStyle="rgb(255, 255, 255)",t.ctx.stroke(),t.ctx.beginPath(),t.ctx.moveTo(this.x*e+.5*e,this.y*e+.05*e),t.ctx.lineTo(this.x*e+.5*e,this.y*e+.4*e),t.ctx.lineTo(this.x*e+e*(this.antiClockwise?.3:.7),this.y*e+.225*e),t.ctx.fillStyle="rgb(255, 255, 255)",t.ctx.fill()}update(t){const e=[t.cellAt(this.x,this.y-1),t.cellAt(this.x,this.y+1),t.cellAt(this.x-1,this.y),t.cellAt(this.x+1,this.y)];for(const t of e)t&&"function"==typeof t.rotateClockwise&&(this.antiClockwise?t.rotateAntiClockwise():t.rotateClockwise())}rotateClockwise(){return this.antiClockwise=!this.antiClockwise,!0}rotateAntiClockwise(){return this.antiClockwise=!this.antiClockwise,!0}}const u=(t,e,s)=>{for(;t<e;)t+=s;for(;t>=s;)t-=s;return t};class p extends d{constructor(t=0,e=0,s=!1){super(t,e,s),this.color="rgb(20, 100, 50)"}update(t){const e=[[this.x,u(this.y-1,0,t.height)],[u(this.x+1,0,t.width),this.y],[this.x,u(this.y+1,0,t.height)],[u(this.x-1,0,t.width),this.y]],s=[],i=(r,c=[])=>{if(c.includes(r))return!0;const h=e[r],n=t.cellAt(...h);if(!n)return!0;if(n instanceof l)return!1;const o=u(r+(this.antiClockwise?-1:1),0,4);return!!i(o,c.concat(r))&&(s.push([n,e[o]]),!0)};for(let t=0;t<e.length;t++)i(t);for(const t of s)t[0].x=t[1][0],t[0].y=t[1][1]}rotateClockwise(){return this.antiClockwise=!this.antiClockwise,!0}rotateAntiClockwise(){return this.antiClockwise=!this.antiClockwise,!0}}class x extends t{constructor(t=0,e=0){super(t,e),this.color="rgb(10, 10, 30)"}render(t,e){super.render(t,e),t.ctx.beginPath(),t.ctx.arc(this.x*e+.5*e,this.y*e+.5*e,.3*e,0,2*Math.PI),t.ctx.lineWidth=.1*e,t.ctx.strokeStyle="rgb(100, 100, 120)",t.ctx.stroke(),t.ctx.beginPath(),t.ctx.arc(this.x*e+.5*e,this.y*e+.5*e,.1*e,0,2*Math.PI),t.ctx.lineWidth=.05*e,t.ctx.strokeStyle="rgb(100, 100, 120)",t.ctx.stroke()}update(t){const e=[t.cellAt(this.x-1,this.y-1),t.cellAt(this.x,this.y-1),t.cellAt(this.x+1,this.y-1),t.cellAt(this.x-1,this.y),t.cellAt(this.x+1,this.y),t.cellAt(this.x-1,this.y+1),t.cellAt(this.x,this.y+1),t.cellAt(this.x+1,this.y+1)];for(const s of e)!s||s instanceof x||t.cells.delete(s)}}const m=[o,p,d,class extends n{constructor(t=0,e=0,s=0){super(t,e,s),this.color="rgb(250, 100, 20)"}update(t){switch(this.dir){case 0:this.suckToNegativeY(t);break;case 1:this.suckToPositiveX(t);break;case 2:this.suckToPositiveY(t);break;case 3:this.suckToNegativeX(t)}}opposingForceCheck(t,e,s){return!this.cellToSuck(t)||super.opposingForceCheck(t,e,s)}cellToSuck(t){switch(this.dir){case 0:return t.cellAt(this.x,this.incrementedY(t));case 1:return t.cellAt(this.decrementedX(t),this.y);case 2:return t.cellAt(this.x,this.decrementedY(t));case 3:return t.cellAt(this.incrementedX(t),this.y)}}suckToPositiveX(t){const e=this.cellToSuck(t);return!!e&&(!!this.pushPositiveX(t)&&(e.x=this.incrementedX(t),!0))}suckToNegativeX(t){const e=this.cellToSuck(t);return!!e&&(!!this.pushNegativeX(t)&&(e.x=this.decrementedX(t),!0))}suckToPositiveY(t){const e=this.cellToSuck(t);return!!e&&(!!this.pushPositiveY(t)&&(e.y=this.incrementedY(t),!0))}suckToNegativeY(t){const e=this.cellToSuck(t);return!!e&&(!!this.pushNegativeY(t)&&(e.y=this.decrementedY(t),!0))}},n,a,s,x,l,t];CanvasRenderingContext2D.prototype.roundRect=function(t,e,s,i,r){return s<2*r&&(r=s/2),i<2*r&&(r=i/2),this.beginPath(),this.moveTo(t+r,e),this.arcTo(t+s,e,t+s,e+i,r),this.arcTo(t+s,e+i,t,e+i,r),this.arcTo(t,e+i,t,e,r),this.arcTo(t,e,t+s,e,r),this.closePath(),this};new class{BORDER_RADIUS=.1;GRID_GAP=.05;constructor(t,e=5,s=60){this.grid=t,this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.mouse={x:0,y:0},this.canvas.addEventListener("mousemove",this.mouseMove.bind(this),!1),window.addEventListener("keydown",this.keyDown.bind(this),!0),this.doUpdate=!0,this.lastUpdate=0,this.lastUpdateDelay=0,this.tps=e,this.lastRender=0,this.lastRenderDelay=0,this.fps=s,window.requestAnimationFrame(this.updateLoop.bind(this)),window.requestAnimationFrame(this.renderLoop.bind(this))}update(){if(!this.doUpdate)return;const t=m.map((t=>t.name)),e=(e,s)=>t.indexOf(e.constructor.name)>t.indexOf(s.constructor.name)?1:-1;for(const t of[...this.grid.cells.values()].sort(e))t.update(this.grid)}updateLoop(){this.lastUpdate=Date.now(),this.update(),this.lastUpdateDelay=1e3/this.tps-(Date.now()-this.lastUpdate),setTimeout((()=>window.requestAnimationFrame(this.updateLoop.bind(this))),this.lastUpdateDelay)}render(){const t=this.canvas.getBoundingClientRect();this.canvas.width=t.width,this.canvas.height=t.height;const e=Math.min(t.width/this.grid.width,t.height/this.grid.height);this.ctx.fillStyle="rgb(10, 10, 20)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);for(let t=0;t<this.grid.height;t++)for(let s=0;s<this.grid.width;s++)this.ctx.beginPath(),this.ctx.roundRect(s*e+e*this.GRID_GAP,t*e+e*this.GRID_GAP,e-e*this.GRID_GAP*2,e-e*this.GRID_GAP*2,e*this.BORDER_RADIUS),this.ctx.fillStyle="rgb(30, 30, 40)",this.ctx.fill();for(const t of this.grid.cells)t.render(this,e);this.ctx.beginPath(),this.ctx.roundRect(this.mouse.x*e,this.mouse.y*e,e,e,e*this.BORDER_RADIUS),this.ctx.fillStyle="rgba(200, 10, 100, 0.5)",this.ctx.fill(),this.ctx.lineWidth=e*this.GRID_GAP*2,this.ctx.strokeStyle="rgba(200, 10, 100, 0.75)",this.ctx.stroke();this.ctx.fillStyle="rgba(250, 250, 255, 0.75)",this.ctx.font="400 14px monospace";const s=["Escape: Destroy all cells","Backspace: Destroy current cell","R: Rotate current cell","WASD: Move current cell","","Space: Pause/Unpause simulation","ArrowUp: Increase simulation speed (2x)","ArrowDown: Decrease simulation speed (0.5x)",`Current speed: ${this.tps.toLocaleString()} TPS${this.doUpdate?"":" (Paused)"}${this.lastUpdateDelay<0?` (Lagging ${this.lastUpdateDelay.toLocaleString()}ms)`:""} | ${this.fps.toLocaleString()} FPS${this.lastRenderDelay<0?` (Lagging ${this.lastRenderDelay.toLocaleString()}ms)`:""}`,"",`Insert cells: ${Array(m.length).fill(null).map(((t,e)=>`${e.toLocaleString()}:    `)).join("")}`];let i=this.canvas.height-16.8;for(const t of s.reverse())this.ctx.fillText(t,16.8,i),i-=16.8;const r=24.5,c=(this.canvas.height-33.6)/r,h=this.ctx.measureText(" ").width,n=18*h;for(let t=0;t<m.length;t++){new m[t]((t*h*6+n)/r,c).render(this,r)}}renderLoop(){this.lastRender=Date.now(),this.render(),this.lastRenderDelay=1e3/this.fps-(Date.now()-this.lastRender),setTimeout((()=>window.requestAnimationFrame(this.renderLoop.bind(this))),this.lastRenderDelay)}mouseMove(t){const e=this.canvas.getBoundingClientRect(),s=Math.min(e.width/this.grid.width,e.height/this.grid.height);this.mouse.x=Math.min(Math.max(Math.floor((t.clientX-e.left)/s),0),this.grid.width-1),this.mouse.y=Math.min(Math.max(Math.floor((t.clientY-e.top)/s),0),this.grid.height-1)}keyDown(t){switch(t.key){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":if(!this.grid.cellAt(this.mouse.x,this.mouse.y)){const e=m[parseInt(t.key,10)];this.grid.cells.add(new e(this.mouse.x,this.mouse.y))}break;case"Escape":this.grid.cells.clear();break;case"Backspace":{const t=this.grid.cellAt(this.mouse.x,this.mouse.y);t&&this.grid.cells.delete(t);break}case"r":{const t=this.grid.cellAt(this.mouse.x,this.mouse.y);t&&"function"==typeof t.rotateClockwise&&t.rotateClockwise();break}case"w":{const t=this.grid.cellAt(this.mouse.x,this.mouse.y);t&&t.decrementY(this.grid,t)&&(this.mouse.y=t.y);break}case"a":{const t=this.grid.cellAt(this.mouse.x,this.mouse.y);t&&t.decrementX(this.grid,t)&&(this.mouse.x=t.x);break}case"s":{const t=this.grid.cellAt(this.mouse.x,this.mouse.y);t&&t.incrementY(this.grid,t)&&(this.mouse.y=t.y);break}case"d":{const t=this.grid.cellAt(this.mouse.x,this.mouse.y);t&&t.incrementX(this.grid,t)&&(this.mouse.x=t.x);break}case" ":this.doUpdate=!this.doUpdate;break;case"ArrowUp":this.tps=2*this.tps;break;case"ArrowDown":this.tps=Math.max(Math.round(this.tps/2),1)}}}(new class{constructor(t,e,s=new Set){this.width=t,this.height=e,this.cells=s}cellAt(t,e){for(const s of this.cells)if(s.x===t&&s.y===e)return s}}(80,40,new Set([new t(4,5),new l(8,5),new a(13,5,1),new t(15,5),new t(15,0),new o(15,1,2),new n(14,2,1),new s(12,1,2),new s(12,4,2),new d(5,6,!1),new o(15,6,2),new d(5,8,!1),new d(20,12,!1),new d(20,13,!0),new a(32,15,1),new d(30,15),new d(33,14),new d(34,17),new d(31,18),new p(40,20),new t(40,21),new x(50,25),new x(52,25)])),10,30)}();</script> </body></html>